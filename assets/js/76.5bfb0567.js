(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{508:function(t,s,a){"use strict";a.r(s);var r=a(2),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"一、什么是-npm-脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、什么是-npm-脚本"}},[t._v("#")]),t._v(" 一、什么是 npm 脚本？")]),t._v(" "),s("p",[t._v("npm 允许在"),s("code",[t._v("package.json")]),t._v("文件里面，使用"),s("code",[t._v("scripts")]),t._v("字段定义脚本命令。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"build"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node build.js"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("上面代码是"),s("code",[t._v("package.json")]),t._v("文件的一个片段，里面的"),s("code",[t._v("scripts")]),t._v("字段是一个对象。它的每一个属性，对应一段脚本。比如，"),s("code",[t._v("build")]),t._v("命令对应的脚本是"),s("code",[t._v("node build.js")]),t._v("。")]),t._v(" "),s("p",[t._v("命令行下使用"),s("code",[t._v("npm run")]),t._v("命令，就可以执行这段脚本。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 等同于执行")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" build.js\n")])])])]),t._v(" "),s("p",[t._v("这些定义在"),s("code",[t._v("package.json")]),t._v("里面的脚本，就称为 npm 脚本。它的优点很多。")]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("项目的相关脚本，可以集中在一个地方。")]),t._v(" "),s("li",[t._v("不同项目的脚本命令，只要功能相同，就可以有同样的对外接口。用户不需要知道怎么测试你的项目，只要运行"),s("code",[t._v("npm run test")]),t._v("即可。")]),t._v(" "),s("li",[t._v("可以利用 npm 提供的很多辅助功能。")])])]),t._v(" "),s("p",[t._v("查看当前项目的所有 npm 脚本命令，可以使用不带任何参数的"),s("code",[t._v("npm run")]),t._v("命令。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run\n")])])])]),t._v(" "),s("h2",{attrs:{id:"二、原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、原理"}},[t._v("#")]),t._v(" 二、原理")]),t._v(" "),s("p",[t._v("npm 脚本的原理非常简单。每当执行"),s("code",[t._v("npm run")]),t._v("，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。因此，只要是 Shell（一般是 Bash）可以运行的命令，就可以写在 npm 脚本里面。")]),t._v(" "),s("p",[t._v("比较特别的是，"),s("code",[t._v("npm run")]),t._v("新建的这个 Shell，会将当前目录的"),s("code",[t._v("node_modules/.bin")]),t._v("子目录加入"),s("code",[t._v("PATH")]),t._v("变量，执行结束后，再将"),s("code",[t._v("PATH")]),t._v("变量恢复原样。")]),t._v(" "),s("p",[t._v("这意味着，当前目录的"),s("code",[t._v("node_modules/.bin")]),t._v("子目录里面的所有脚本，都可以直接用脚本名调用，而不必加上路径。比如，当前项目的依赖里面有 Mocha，只要直接写"),s("code",[t._v("mocha test")]),t._v("就可以了。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mocha test"')]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("而不用写成下面这样。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./node_modules/.bin/mocha test"')]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("由于 npm 脚本的唯一要求就是可以在 Shell 执行，因此它不一定是 Node 脚本，任何可执行文件都可以写在里面。")]),t._v(" "),s("p",[t._v("npm 脚本的退出码，也遵守 Shell 脚本规则。如果退出码不是"),s("code",[t._v("0")]),t._v("，npm 就认为这个脚本执行失败。")]),t._v(" "),s("h2",{attrs:{id:"三、通配符"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、通配符"}},[t._v("#")]),t._v(" 三、通配符")]),t._v(" "),s("p",[t._v("由于 npm 脚本就是 Shell 脚本，因为可以使用 Shell 通配符。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"lint"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jshint *.js"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"lint"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jshint **/*.js"')]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("上面代码中，"),s("code",[t._v("*")]),t._v("表示任意文件名，"),s("code",[t._v("**")]),t._v("表示任意一层子目录。")]),t._v(" "),s("p",[t._v("如果要将通配符传入原始命令，防止被 Shell 转义，要将星号转义。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tap test/\\*.js"')]),t._v("\n")])])])]),t._v(" "),s("h2",{attrs:{id:"四、传参"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、传参"}},[t._v("#")]),t._v(" 四、传参")]),t._v(" "),s("p",[t._v("向 npm 脚本传入参数，要使用"),s("code",[t._v("--")]),t._v("标明。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"lint"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jshint **.js"')]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("向上面的"),s("code",[t._v("npm run lint")]),t._v("命令传入参数，必须写成下面这样。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run lint --  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reporter")]),t._v(" checkstyle "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" checkstyle.xml\n")])])])]),t._v(" "),s("p",[t._v("也可以在"),s("code",[t._v("package.json")]),t._v("里面再封装一个命令。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"lint"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jshint **.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"lint:checkstyle"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm run lint -- --reporter checkstyle > checkstyle.xml"')]),t._v("\n")])])])]),t._v(" "),s("h2",{attrs:{id:"五、执行顺序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、执行顺序"}},[t._v("#")]),t._v(" 五、执行顺序")]),t._v(" "),s("p",[t._v("如果 npm 脚本里面需要执行多个任务，那么需要明确它们的执行顺序。")]),t._v(" "),s("p",[t._v("如果是并行执行（即同时的平行执行），可以使用"),s("code",[t._v("&")]),t._v("符号。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run script1.js "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run script2.js\n")])])])]),t._v(" "),s("p",[t._v("如果是继发执行（即只有前一个任务成功，才执行下一个任务），可以使用"),s("code",[t._v("&&")]),t._v("符号。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run script1.js "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run script2.js\n")])])])]),t._v(" "),s("p",[t._v("这两个符号是 Bash 的功能。此外，还可以使用 node 的任务管理模块："),s("a",{attrs:{href:"https://github.com/paulpflug/script-runner",target:"_blank",rel:"noopener noreferrer"}},[t._v("script-runner"),s("OutboundLink")],1),t._v("、"),s("a",{attrs:{href:"https://github.com/mysticatea/npm-run-all",target:"_blank",rel:"noopener noreferrer"}},[t._v("npm-run-all"),s("OutboundLink")],1),t._v("、"),s("a",{attrs:{href:"https://github.com/coderaiser/redrun",target:"_blank",rel:"noopener noreferrer"}},[t._v("redrun"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"六、默认值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、默认值"}},[t._v("#")]),t._v(" 六、默认值")]),t._v(" "),s("p",[t._v("一般来说，npm 脚本由用户提供。但是，npm 对两个脚本提供了默认值。也就是说，这两个脚本不用定义，就可以直接使用。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"start"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node server.js"')]),t._v("，\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"install"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node-gyp rebuild"')]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("上面代码中，"),s("code",[t._v("npm run start")]),t._v("的默认值是"),s("code",[t._v("node server.js")]),t._v("，前提是项目根目录下有"),s("code",[t._v("server.js")]),t._v("这个脚本；"),s("code",[t._v("npm run install")]),t._v("的默认值是"),s("code",[t._v("node-gyp rebuild")]),t._v("，前提是项目根目录下有"),s("code",[t._v("binding.gyp")]),t._v("文件。")]),t._v(" "),s("h2",{attrs:{id:"七、钩子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#七、钩子"}},[t._v("#")]),t._v(" 七、钩子")]),t._v(" "),s("p",[t._v("npm 脚本有"),s("code",[t._v("pre")]),t._v("和"),s("code",[t._v("post")]),t._v("两个钩子。举例来说，"),s("code",[t._v("build")]),t._v("脚本命令的钩子就是"),s("code",[t._v("prebuild")]),t._v("和"),s("code",[t._v("postbuild")]),t._v("。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"prebuild"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo I run before the build script"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"build"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cross-env NODE_ENV=production webpack"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"postbuild"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo I run after the build script"')]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("用户执行"),s("code",[t._v("npm run build")]),t._v("的时候，会自动按照下面的顺序执行。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run prebuild "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run postbuild\n")])])])]),t._v(" "),s("p",[t._v("因此，可以在这两个钩子里面，完成一些准备工作和清理工作。下面是一个例子。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"clean"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rimraf ./dist && mkdir dist"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"prebuild"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm run clean"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"build"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cross-env NODE_ENV=production webpack"')]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("npm 默认提供下面这些钩子。")]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("prepublish，postpublish")]),t._v(" "),s("li",[t._v("preinstall，postinstall")]),t._v(" "),s("li",[t._v("preuninstall，postuninstall")]),t._v(" "),s("li",[t._v("preversion，postversion")]),t._v(" "),s("li",[t._v("pretest，posttest")]),t._v(" "),s("li",[t._v("prestop，poststop")]),t._v(" "),s("li",[t._v("prestart，poststart")]),t._v(" "),s("li",[t._v("prerestart，postrestart")])])]),t._v(" "),s("p",[t._v("自定义的脚本命令也可以加上"),s("code",[t._v("pre")]),t._v("和"),s("code",[t._v("post")]),t._v("钩子。比如，"),s("code",[t._v("myscript")]),t._v("这个脚本命令，也有"),s("code",[t._v("premyscript")]),t._v("和"),s("code",[t._v("postmyscript")]),t._v("钩子。不过，双重的"),s("code",[t._v("pre")]),t._v("和"),s("code",[t._v("post")]),t._v("无效，比如"),s("code",[t._v("prepretest")]),t._v("和"),s("code",[t._v("postposttest")]),t._v("是无效的。")]),t._v(" "),s("p",[t._v("npm 提供一个"),s("code",[t._v("npm_lifecycle_event")]),t._v("变量，返回当前正在运行的脚本名称，比如"),s("code",[t._v("pretest")]),t._v("、"),s("code",[t._v("test")]),t._v("、"),s("code",[t._v("posttest")]),t._v("等等。所以，可以利用这个变量，在同一个脚本文件里面，为不同的"),s("code",[t._v("npm scripts")]),t._v("命令编写代码。请看下面的例子。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TARGET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm_lifecycle_event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TARGET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Running the test task!")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TARGET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pretest'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Running the pretest task!")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TARGET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'posttest'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Running the posttest task!")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("注意，"),s("code",[t._v("prepublish")]),t._v("这个钩子不仅会在"),s("code",[t._v("npm publish")]),t._v("命令之前运行，还会在"),s("code",[t._v("npm install")]),t._v("（不带任何参数）命令之前运行。这种行为很容易让用户感到困惑，所以 npm 4 引入了一个新的钩子"),s("code",[t._v("prepare")]),t._v("，行为等同于"),s("code",[t._v("prepublish")]),t._v("，而从 npm 5 开始，"),s("code",[t._v("prepublish")]),t._v("将只在"),s("code",[t._v("npm publish")]),t._v("命令之前运行。")]),t._v(" "),s("h2",{attrs:{id:"八、简写形式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#八、简写形式"}},[t._v("#")]),t._v(" 八、简写形式")]),t._v(" "),s("p",[t._v("四个常用的 npm 脚本有简写形式。")]),t._v(" "),s("blockquote",[s("ul",[s("li",[s("code",[t._v("npm start")]),t._v("是"),s("code",[t._v("npm run start")])]),t._v(" "),s("li",[s("code",[t._v("npm stop")]),t._v("是"),s("code",[t._v("npm run stop")]),t._v("的简写")]),t._v(" "),s("li",[s("code",[t._v("npm test")]),t._v("是"),s("code",[t._v("npm run test")]),t._v("的简写")]),t._v(" "),s("li",[s("code",[t._v("npm restart")]),t._v("是"),s("code",[t._v("npm run stop && npm run restart && npm run start")]),t._v("的简写")])])]),t._v(" "),s("p",[s("code",[t._v("npm start")]),t._v("、"),s("code",[t._v("npm stop")]),t._v("和"),s("code",[t._v("npm restart")]),t._v("都比较好理解，而"),s("code",[t._v("npm restart")]),t._v("是一个复合命令，实际上会执行三个脚本命令："),s("code",[t._v("stop")]),t._v("、"),s("code",[t._v("restart")]),t._v("、"),s("code",[t._v("start")]),t._v("。具体的执行顺序如下。")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("prerestart")]),t._v(" "),s("li",[t._v("prestop")]),t._v(" "),s("li",[t._v("stop")]),t._v(" "),s("li",[t._v("poststop")]),t._v(" "),s("li",[t._v("restart")]),t._v(" "),s("li",[t._v("prestart")]),t._v(" "),s("li",[t._v("start")]),t._v(" "),s("li",[t._v("poststart")]),t._v(" "),s("li",[t._v("postrestart")])])]),t._v(" "),s("h2",{attrs:{id:"九、变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#九、变量"}},[t._v("#")]),t._v(" 九、变量")]),t._v(" "),s("p",[t._v("npm 脚本有一个非常强大的功能，就是可以使用 npm 的内部变量。")]),t._v(" "),s("p",[t._v("首先，通过"),s("code",[t._v("npm_package_")]),t._v("前缀，npm 脚本可以拿到"),s("code",[t._v("package.json")]),t._v("里面的字段。比如，下面是一个"),s("code",[t._v("package.json")]),t._v("。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.2.5"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"view"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node view.js"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("那么，变量"),s("code",[t._v("npm_package_name")]),t._v("返回"),s("code",[t._v("foo")]),t._v("，变量"),s("code",[t._v("npm_package_version")]),t._v("返回"),s("code",[t._v("1.2.5")]),t._v("。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// view.js")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm_package_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// foo")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm_package_version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.2.5")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("上面代码中，我们通过环境变量"),s("code",[t._v("process.env")]),t._v("对象，拿到"),s("code",[t._v("package.json")]),t._v("的字段值。如果是 Bash 脚本，可以用"),s("code",[t._v("$npm_package_name")]),t._v("和"),s("code",[t._v("$npm_package_version")]),t._v("取到这两个值。")]),t._v(" "),s("p",[s("code",[t._v("npm_package_")]),t._v("前缀也支持嵌套的"),s("code",[t._v("package.json")]),t._v("字段。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"repository"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"url"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("scripts")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"view"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo $npm_package_repository_type"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("上面代码中，"),s("code",[t._v("repository")]),t._v("字段的"),s("code",[t._v("type")]),t._v("属性，可以通过"),s("code",[t._v("npm_package_repository_type")]),t._v("取到。")]),t._v(" "),s("p",[t._v("下面是另外一个例子。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"install"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo.js"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("上面代码中，"),s("code",[t._v("npm_package_scripts_install")]),t._v("变量的值等于"),s("code",[t._v("foo.js")]),t._v("。")]),t._v(" "),s("p",[t._v("然后，npm 脚本还可以通过"),s("code",[t._v("npm_config_")]),t._v("前缀，拿到 npm 的配置变量，即"),s("code",[t._v("npm config get xxx")]),t._v("命令返回的值。比如，当前模块的发行标签，可以通过"),s("code",[t._v("npm_config_tag")]),t._v("取到。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"view"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo $npm_config_tag"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("注意，"),s("code",[t._v("package.json")]),t._v("里面的"),s("code",[t._v("config")]),t._v("对象，可以被环境变量覆盖。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"config"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"port"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"scripts"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"start"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node server.js"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("上面代码中，"),s("code",[t._v("npm_package_config_port")]),t._v("变量返回的是"),s("code",[t._v("8080")]),t._v("。这个值可以用下面的方法覆盖。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" foo:port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("最后，"),s("code",[t._v("env")]),t._v("命令可以列出所有环境变量。")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"env"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"env"')]),t._v("\n")])])])]),t._v(" "),s("h2",{attrs:{id:"十、常用脚本示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#十、常用脚本示例"}},[t._v("#")]),t._v(" 十、常用脚本示例")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"clean"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rimraf dist/*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 本地搭建一个 HTTP 服务")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"serve"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http-server -p 9090 dist/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打开浏览器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"open:dev"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"opener http://localhost:9090"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实时刷新")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"livereload"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"live-reload --port 9091 dist/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 构建 HTML 文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"build:html"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jade index.jade > dist/index.html"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只要 CSS 文件有变动，就重新执行构建")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"watch:css"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"watch 'npm run build:css' assets/styles/\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只要 HTML 文件有变动，就重新执行构建")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"watch:html"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"watch 'npm run build:html' assets/html\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 部署到 Amazon S3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"deploy:prod"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s3-cli sync ./dist/ s3://example-com/prod-site/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 构建 favicon")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"build:favicon"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node scripts/favicon.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);
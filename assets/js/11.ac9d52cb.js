(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{349:function(_,v,r){"use strict";r.r(v);var o=r(350),t=r.n(o);for(var e in o)["default"].indexOf(e)<0&&function(_){r.d(v,_,(function(){return o[_]}))}(e);v.default=t.a},350:function(_,v){},441:function(_,v,r){"use strict";r.d(v,"a",(function(){return o})),r.d(v,"b",(function(){return t}));var o=function(){var _=this,v=_._self._c;_._self._setupProxy;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h2",{attrs:{id:"前言"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[_._v("#")]),_._v(" 前言")]),_._v(" "),v("p",[_._v("起因是：本小哥在某天接到一个特殊的需求，要"),v("strong",[_._v("用前端的方式判断任意一个url，是否可以正常访问")]),_._v("。\n这么简短的需求，通常背后都有个大坑")]),_._v(" "),v("p",[_._v("先捊下思路，要实现这个功能，必须具备以下2点：")]),_._v(" "),v("ul",[v("li",[_._v("正常发起url请求")]),_._v(" "),v("li",[_._v("监听请求状态")])]),_._v(" "),v("p",[_._v("有了思路，就开始撸起袖子加油干！")]),_._v(" "),v("h2",{attrs:{id:"一、判断url是否可访问"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一、判断url是否可访问"}},[_._v("#")]),_._v(" 一、判断url是否可访问")]),_._v(" "),v("p",[_._v("由于浏览器的安全机制——"),v("strong",[_._v("同源策略")]),_._v("的存在，要实现"),v("code",[_._v("任意")]),_._v("这个要求确实有点难。")]),_._v(" "),v("blockquote",[v("p",[_._v("同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。")])]),_._v(" "),v("p",[_._v("所以，为了实现任意url可以正常访问，第一个要解决的问题就是："),v("strong",[_._v("跨域")]),_._v("。")]),_._v(" "),v("h3",{attrs:{id:"_1-1-解决同源限制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-解决同源限制"}},[_._v("#")]),_._v(" 1.1 解决同源限制")]),_._v(" "),v("p",[_._v("前端老鸟很快就会联想到"),v("code",[_._v("JSONP")]),_._v("。其原理其实是利用"),v("code",[_._v("script")]),_._v("可跨源访问的特性。\n依据这个，可以做个拓展，找出所有可跨源访问的html标签：")]),_._v(" "),v("ul",[v("li",[v("code",[_._v("<script>")])]),_._v(" "),v("li",[v("code",[_._v("<img>")])]),_._v(" "),v("li",[v("code",[_._v("<link>")])]),_._v(" "),v("li",[v("code",[_._v("<video>")])]),_._v(" "),v("li",[v("code",[_._v("<audio>")])]),_._v(" "),v("li",[v("code",[_._v("<audio>")])]),_._v(" "),v("li",[v("code",[_._v("<iframe>")])])]),_._v(" "),v("h3",{attrs:{id:"_1-2-如何判断访问性"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-如何判断访问性"}},[_._v("#")]),_._v(" 1.2 如何判断访问性")]),_._v(" "),v("p",[_._v("从可跨源访问的html标签中，筛选出能支持"),v("code",[_._v("onerror")]),_._v("和"),v("code",[_._v("onload")]),_._v("事件标签，则可以依靠标签很好地完成功能的开发。\n这里说明下：")]),_._v(" "),v("ul",[v("li",[v("strong",[v("code",[_._v("onerror")]),_._v("事件的作用")]),_._v("\n如果跨源标签请求的资源，和本身能解析的文件格式不一样，就会报"),v("code",[_._v("error")]),_._v("事件。\n而要检测的url，通常都是"),v("code",[_._v("html")]),_._v("。\n所以"),v("code",[_._v("onerror")]),_._v("事件可以用于监听发起请求，到接收到反馈"),v("code",[_._v("error")]),_._v("所花费的时间。这样，就可以直接算出网络访问的延时。\n但是，很遗憾，准确率并不是100%。\n因为有一种情况是：url本身就是死链。\n用死链发起http请求后，会得到"),v("code",[_._v("failed")]),_._v("的状态。这种情况下"),v("code",[_._v("onerror")]),_._v("也是会触发的。")]),_._v(" "),v("li",[v("strong",[_._v("为什么需要"),v("code",[_._v("onload")]),_._v("事件？")]),_._v(" "),v("code",[_._v("onload")]),_._v("事件的触发时机是资源已下载完成。\n只要触发这个事件，则证明url不是死链。\n这样，就可以帮"),v("code",[_._v("onerror")]),_._v("排除意外情况，让准确率达到100%!")])]),_._v(" "),v("p",[_._v("基于以上两点硬性要求，对标签进行过滤后如下：")]),_._v(" "),v("ul",[v("li",[v("code",[_._v("<script>")])]),_._v(" "),v("li",[v("code",[_._v("<img>")])]),_._v(" "),v("li",[v("code",[_._v("<link>")])])]),_._v(" "),v("p",[_._v("其中"),v("code",[_._v("<iframe>")]),_._v("的硬伤是：只要服务器设置"),v("code",[_._v("X-Frame-Options")]),_._v("消息头，就直接废了。所以也被排除掉。")]),_._v(" "),v("blockquote",[v("p",[_._v("X-Frame-Options是一个HTTP标头（header），用来告诉浏览器这个网页是否可以放在iFrame内。")])]),_._v(" "),v("h3",{attrs:{id:"_1-3-存在的安全隐患"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-存在的安全隐患"}},[_._v("#")]),_._v(" 1.3 存在的安全隐患")])])},t=[]},442:function(_,v,r){"use strict";r.r(v);var o=r(441),t=r(349);for(var e in t)["default"].indexOf(e)<0&&function(_){r.d(v,_,(function(){return t[_]}))}(e);var n=r(2),a=Object(n.a)(t.default,o.a,o.b,!1,null,null,null);v.default=a.exports}}]);